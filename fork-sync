#!/bin/bash
# Script to sync with upstream pyprojectx repository

set -e

echo "ğŸ”„ Syncing with upstream pyprojectx..."

# Fetch latest changes from upstream
echo "Fetching upstream changes..."
git fetch upstream

# Check if we're on main branch
CURRENT_BRANCH=$(git rev-parse --abbrev-ref HEAD)
if [ "$CURRENT_BRANCH" != "main" ]; then
    echo "âš ï¸  Warning: You're not on the main branch (current: $CURRENT_BRANCH)"
    echo "Switch to main branch first: git checkout main"
    exit 1
fi

# Check for uncommitted changes
if ! git diff-index --quiet HEAD --; then
    echo "âš ï¸  Warning: You have uncommitted changes. Please commit or stash them first."
    git status --short
    exit 1
fi

# Show what would be merged
echo "ğŸ“Š Changes that would be merged:"
git log --oneline main..upstream/main

echo ""
read -p "ğŸ¤” Do you want to merge these changes? (y/N): " -n 1 -r
echo
if [[ $REPLY =~ ^[Yy]$ ]]; then
    echo "ğŸ”€ Merging upstream changes..."
    git merge upstream/main
    
    echo "âœ… Upstream sync completed!"
    echo "ğŸ“¤ Push to your fork with: git push origin main"
else
    echo "âŒ Sync cancelled."
fi